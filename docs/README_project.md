---

# üé¨ UGC Analytics ‚Äî –°–ø—Ä–∏–Ω—Ç 9

### *–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ*

---

## üìò –¶–µ–ª—å

–í —ç—Ç–æ–º —Å–ø—Ä–∏–Ω—Ç–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±–ª–æ–∫ **UGC** (–ª–∞–π–∫–∏, –∑–∞–∫–ª–∞–¥–∫–∏, —Ä–µ—Ü–µ–Ω–∑–∏–∏, —Ä–µ–π—Ç–∏–Ω–≥–∏).
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ä–∞–≤–Ω–∏—Ç—å **MongoDB** –∏ **PostgreSQL** –Ω–∞ –æ–±—ä—ë–º–µ –¥–∞–Ω–Ω—ã—Ö ‚â• 10 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π,
–ø—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ –æ –≤—ã–±–æ—Ä–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
–¢–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è **ELK**, **Sentry** –∏ **CI/CD (GitHub Actions)**.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

* **FastAPI + Motor + PyMongo + Psycopg 3.2** ‚Äî —Å–µ—Ä–≤–∏—Å –∏ —É—Ç–∏–ª–∏—Ç—ã.
* **MongoDB 7.0 (rs0)** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ UGC-—Å—É—â–Ω–æ—Å—Ç–µ–π.
* **PostgreSQL 16** ‚Äî –±–∞–∑–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
* **Docker Compose** ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (infra/bench-compose.yml).
* **ELK Stack + Sentry** ‚Äî –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
* **CI/CD ‚Äî GitHub Actions** —Å –ª–∏–Ω—Ç–µ—Ä–∞–º–∏, —Ç–µ—Å—Ç–∞–º–∏ –∏ Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

|  ‚Ññ  | –°—Ü–µ–Ω–∞—Ä–∏–π                                   | Mongo p50/p95 | Postgres p50/p95 | –í—ã–≤–æ–¥                             |
| :-: | ------------------------------------------ | ------------- | ---------------- | --------------------------------- |
|  1  | Upsert + Get + Agg (—Ä–µ–π—Ç–∏–Ω–≥–∏ / –ª–∞–π–∫–∏)      | ‚âà 29 / 40 –º—Å  | ‚âà 1.7 / 2.1 –º—Å   | Postgres –±—ã—Å—Ç—Ä–µ–µ ‚âà20√ó             |
|  2  | –†–µ—Ü–µ–Ω–∑–∏–∏ (top-20 + –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5)            | ‚âà 7 / 14 –º—Å   | ‚âà 6 / 8 –º—Å       | –°—Ä–∞–≤–Ω–∏–º–æ                          |
|  3  | Document vs Relational (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã) | ‚âà 23 / 44 –º—Å  | ‚âà 2.5 / 3.3 –º—Å   | Pg –±—ã—Å—Ç—Ä–µ–µ                        |
|  4  | Top-N –ø–æ –º–Ω–æ–≥–∏–º —Ñ–∏–ª—å–º–∞–º (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)        | ‚Äî             | ‚Äî                | Pg –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è JOIN / –∞–≥—Ä–µ–≥–∞—Ü–∏–π |

---

### üí° –í—ã–≤–æ–¥—ã

1. **PostgreSQL** ‚Äî —Å—Ç–∞–±–∏–ª–µ–Ω, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º –∏ –±—ã—Å—Ç—Ä–µ–µ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.
2. **MongoDB** ‚Äî –≥–∏–±—á–µ, —Å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏ `$inc` –∏ `$push`, –ø—Ä–æ—â–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å.
3. –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

   * UGC-–¥–∞–Ω–Ω—ã–µ (–ª–∞–π–∫–∏, —Ä–µ—Ü–µ–Ω–∑–∏–∏, –∑–∞–∫–ª–∞–¥–∫–∏) ‚Üí **MongoDB**
   * –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã ‚Üí **PostgreSQL / ClickHouse / Elasticsearch**

---

## üß™ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏

### 1Ô∏è–ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
make bench-setup
```

–ü–æ–¥–Ω–∏–º–∞–µ—Ç Mongo (rs0), Postgres –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `ugc-bench`.

---

### 2Ô∏è‚É£ –°–∏–¥–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö

```bash
make bench-seed-ratings    # 1 –º–ª–Ω —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
make bench-seed-reviews    # 100 —Ç—ã—Å —Ä–µ—Ü–µ–Ω–∑–∏–π
```

---

### 3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

```bash
make bench-ratings       # Upsert / Get / Agg (—Ä–µ–π—Ç–∏–Ω–≥–∏)
make bench-reviews-top   # Top-20 + Tail-5 (—Ä–µ—Ü–µ–Ω–∑–∏–∏)
make bench-doc-vs-rel    # –î–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è vs —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
```

–î–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```bash
make bench-run CMD='OPS=5000 CONCURRENCY=10 python scripts/bench/runs/ratings.py'
```

---

## ‚öôÔ∏è Makefile ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞                                            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      |
| -------------------------------------------------- | ----------------------------------------------- |
| `make dev`                                         | –ó–∞–ø—É—Å–∫ UGC API + Mongo (rs0) + Redis + Postgres |
| `make test`                                        | –ó–∞–ø—É—Å–∫ pytest                                   |
| `make lint`                                        | –õ–∏–Ω—Ç–µ—Ä flake8 (wemake) + HTML-–æ—Ç—á—ë—Ç             |
| `make mypy`                                        | –ü—Ä–æ–≤–µ—Ä–∫–∞ mypy + HTML-–æ—Ç—á—ë—Ç                      |
| `make fmt`                                         | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ruff                             |
| `make elk-up` / `make elk-down` / `make elk-clean` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ELK —Å—Ç–µ–∫–æ–º                           |
| `make bench-*`                                     | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏ (setup, seed, run)       |

---

## üìà ELK Stack

```bash
make elk-up
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

* **Kibana** ‚Äî [http://localhost:5601](http://localhost:5601)
* **Elasticsearch** ‚Äî [http://localhost:9200](http://localhost:9200)

Filebeat ‚Üí Logstash ‚Üí Elasticsearch ‚Üí Kibana (`logs-engagement-*`).

–û—á–∏—Å—Ç–∫–∞:

```bash
make elk-clean
```

---

## ü™≤ Sentry

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```bash
SENTRY_DSN=<dsn>
SENTRY_ENV=local
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
curl http://localhost:8080/__sentry-test
```

---

## ü§ñ CI/CD (GitHub Actions)

–§–∞–π–ª ‚Äî `.github/workflows/ci.yml`

* –ú–∞—Ç—Ä–∏—Ü–∞ Python 3.10 / 3.11 / 3.12
* –õ–∏–Ω—Ç–µ—Ä—ã: `wemake-python-styleguide`, `mypy`, `ruff`
* –¢–µ—Å—Ç—ã: `pytest`
* HTML-–æ—Ç—á—ë—Ç—ã: `reports/mypy`, `reports/flake8`
* Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Secrets: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_TO`)

–ü—Ä–∏–º–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

```
‚úÖ CI PASSED ‚Äî ugc_sprint_2@main
Python 3.11
Commit: abcdef1
Actor: NurzhanSarsenbayev
```

---

## üß∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ugc_api/                # FastAPI UGC-—Å–µ—Ä–≤–∏—Å
scripts/bench/          # –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∏ —Å–∏–¥–µ—Ä—ã –¥–ª—è Mongo / PG
infra/                  # Docker Compose (infra, elk, bench)
tests/                  # Pytest (~93 % –ø–æ–∫—Ä—ã—Ç–∏—è)
.github/workflows/      # CI-–ø–∞–π–ø–ª–∞–π–Ω
docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

---

## üß† –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

| –•—Ä–∞–Ω–∏–ª–∏—â–µ      | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞                                   | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏                                                     | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ                    |
| -------------- | ---------------------------------------------- | -------------------------------------------------------------- | ----------------------------- |
| **MongoDB**    | –ì–∏–±–∫–∞—è —Å—Ö–µ–º–∞, atomic-–æ–ø–µ—Ä–∞—Ü–∏–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–µ—Ç –º–µ–∂–∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –ª–∞–π–∫–∏, —Ä–µ—Ü–µ–Ω–∑–∏–∏, –∑–∞–∫–ª–∞–¥–∫–∏     |
| **PostgreSQL** | –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∏–Ω–¥–µ–∫—Å—ã, SQL, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏          | –ñ—ë—Å—Ç–∫–∞—è —Å—Ö–µ–º–∞, —Å–ª–æ–∂–Ω–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å                          | –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ç—á—ë—Ç—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |

> üí° **–í—ã–±–æ—Ä:**
> MongoDB ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ UGC.
> Postgres ‚Äî –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π –∏ –∞–¥–º–∏–Ω-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.

---
