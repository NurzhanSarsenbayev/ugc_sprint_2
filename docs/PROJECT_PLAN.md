---

```markdown
# üéØ Sprint 9 ‚Äî Engagement Service Project Plan

**–ê–≤—Ç–æ—Ä:** Nurzhan Sarsenbayev  
**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –ª–∞–π–∫–æ–≤, —Ä–µ—Ü–µ–Ω–∑–∏–π –∏ –∑–∞–∫–ª–∞–¥–æ–∫, –ø—Ä–æ–≤–µ—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ MongoDB vs Postgres, –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (ELK + Sentry) –∏ CI/CD (wemake, mypy, Telegram).

---

## üîé –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

- [1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ](#1-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–æ–∫—Ä—É–∂–µ–Ω–∏–µ)
- [2. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ MongoDB](#2-–º–æ–¥–µ–ª–∏-–¥–∞–Ω–Ω—ã—Ö-–∏-mongodb)
- [3. CRUD-API](#3-crud-api)
- [4. ELK-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#4-elk-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [5. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ MongoDB vs Postgres](#5-–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ-mongodb-vs-postgres)
- [6. Sentry](#6-sentry)
- [7. CI/CD](#7-cicd)
- [8. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏—Ç–æ–≥](#8-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-–∏-–∏—Ç–æ–≥)
- [üìÖ –¢–∞–π–º–∏–Ω–≥](#-—Ç–∞–π–º–∏–Ω–≥)

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–ó–∞–¥–∞—á–∏**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `engagement_service` (–∏–ª–∏ –≤–µ—Ç–∫—É `ugc_sprint_9`).
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

```

engagement_service/
ugc_api/
api/v1/
models/
db/
services/
core/
tests/
infra/
docker-compose.yml
elk/
logstash.conf
filebeat.yml
scripts/
seed.py
bench_read.py
bench_write_then_read.py

```

- [ ] –î–æ–±–∞–≤–∏—Ç—å `.env.sample`, `Makefile`, `requirements/dev.txt`.
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –≤ `docker-compose.yml`:
- MongoDB (replicaSet=rs0)
- PostgreSQL
- Elasticsearch + Logstash + Kibana + Filebeat
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- API
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫: `docker compose up -d`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- [ ] –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è.
- [ ] API –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MongoDB.
- [ ] `.env.sample` –∏ `README` –æ–±–Ω–æ–≤–ª–µ–Ω—ã.

---

## 2. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ MongoDB

**–ö–æ–ª–ª–µ–∫—Ü–∏–∏**
- [ ] `ratings` ‚Äî –æ—Ü–µ–Ω–∫–∏ —Ñ–∏–ª—å–º–æ–≤ (`user_id`, `film_id`, `value`, `updated_at`)
- [ ] `film_stats` ‚Äî –∞–≥—Ä–µ–≥–∞—Ç—ã (`likes`, `dislikes`, `avg_rating`)
- [ ] `reviews` ‚Äî —Ä–µ—Ü–µ–Ω–∑–∏–∏ + —Å—á—ë—Ç—á–∏–∫–∏ –≥–æ–ª–æ—Å–æ–≤
- [ ] `review_votes` ‚Äî –≥–æ–ª–æ—Å–∞ –∑–∞ —Ä–µ—Ü–µ–Ω–∑–∏–∏
- [ ] `bookmarks` ‚Äî –∑–∞–∫–ª–∞–¥–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò–Ω–¥–µ–∫—Å—ã**
- [ ] –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ `(user_id, film_id)` –∏ `(review_id, user_id)`
- [ ] –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (`created_at`, `votes.up`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ `db.collection.getIndexes()`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- [ ] CRUD –ø–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º —Ä–∞–±–æ—Ç–∞–µ—Ç.
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–µ–π –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ–º.

---

## 3. CRUD-API

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã**
- [ ] `POST /api/v1/bookmarks`
- [ ] `DELETE /api/v1/bookmarks/{film_id}`
- [ ] `GET /api/v1/bookmarks`
- [ ] `PUT /api/v1/ratings`
- [ ] `GET /api/v1/films/{film_id}/stats`
- [ ] `POST /api/v1/reviews`
- [ ] `POST /api/v1/reviews/{id}/vote`
- [ ] `GET /api/v1/films/{film_id}/reviews`

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**
- [ ] JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (guest ‚Üí —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
- [ ] Pydantic-—Å—Ö–µ–º—ã
- [ ] –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –∞–ø–¥–µ–π—Ç—ã `film_stats`
- [ ] JSON-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (python-json-logger)
- [ ] –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- [ ] –í—Å–µ CRUD-–∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç.
- [ ] –¢–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ.

---

## 4. ELK-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- [ ] –î–æ–±–∞–≤–∏—Ç—å `elasticsearch`, `logstash`, `kibana`, `filebeat`.
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `filebeat.yml` –Ω–∞ —á—Ç–µ–Ω–∏–µ `/var/log/app/*.json`.
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `logstash.conf` (input beats ‚Üí filter json ‚Üí output ES).

**–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏**
- [ ] –õ–æ–≥–≥–µ—Ä JSON —Å –ø–æ–ª—è–º–∏: time, level, service, env, trace_id, latency.
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî –ª–æ–≥–∏ –≤–∏–¥–Ω—ã –≤ Kibana.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- [ ] –ò–Ω–¥–µ–∫—Å `logs-*` —Å–æ–∑–¥–∞–Ω –≤ Elasticsearch.
- [ ] –í Kibana –µ—Å—Ç—å –¥–∞—à–±–æ—Ä–¥ –ø–æ –ª–æ–≥–∞–º.

---

## 5. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ MongoDB vs Postgres

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å `seed.py` (‚â•10 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π).
- [ ] –ù–∞–ø–æ–ª–Ω–∏—Ç—å –æ–±–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã–º–∏.
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ –æ–±–µ–∏—Ö –°–£–ë–î.

**–ë–µ–Ω—á–º–∞—Ä–∫–∏**
- [ ] `bench_read.py`: —á—Ç–µ–Ω–∏–µ –ª–∞–π–∫–æ–≤, –∑–∞–∫–ª–∞–¥–æ–∫, —Ä–µ—Ü–µ–Ω–∑–∏–π.
- [ ] `bench_write_then_read.py`: –∑–∞–ø–∏—Å—å ‚Üí —á—Ç–µ–Ω–∏–µ (latency).
- [ ] –°–±–æ—Ä p50/p95/p99 –≤ CSV/Markdown.
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–µ–π, —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω—ã –≤ `README.md`.
- [ ] –°–¥–µ–ª–∞–Ω –≤—ã–≤–æ–¥ –æ –≤—ã–±–æ—Ä–µ MongoDB.

---

## 6. Sentry

**–ó–∞–¥–∞—á–∏**
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å `sentry-sdk` (FastAPIIntegration / FlaskIntegration).
- [ ] –í–∫–ª—é—á–∏—Ç—å `LoggingIntegration` –¥–ª—è –æ—à–∏–±–æ–∫.
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DSN —á–µ—Ä–µ–∑ `.env`.
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ `/__sentry-test`.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- [ ] –û—à–∏–±–∫–∏ –≤–∏–¥–Ω—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Sentry.
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ–≥–∏ `service`, `release`, `env`.

---

## 7. CI/CD

**–õ–∏–Ω—Ç–µ—Ä—ã**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `wemake-python-styleguide`, `flake8-html`.
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `mypy`.
- [ ] –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å HTML-–æ—Ç—á—ë—Ç—ã (`reports/flake8`, `reports/mypy`).

**GitHub Actions**
- [ ] –°–æ–∑–¥–∞—Ç—å `.github/workflows/ci.yml`:
- [ ] –ú–∞—Ç—Ä–∏—Ü–∞ Python (3.10, 3.11, 3.12)
- [ ] Flake8 + mypy + pytest
- [ ] –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (HTML-–æ—Ç—á—ë—Ç—ã)
- [ ] Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] Trigger: PR –≤ master

**–°–µ–∫—Ä–µ—Ç—ã**
- [ ] `TELEGRAM_BOT_TOKEN`
- [ ] `TELEGRAM_CHAT_ID`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- [ ] CI –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ.
- [ ] Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç.

---

## 8. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏—Ç–æ–≥

**README.md**
- [ ] –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É (`docker compose up`).
- [ ] –ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å Kibana, Sentry.
- [ ] –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
- [ ] –¢–∞–±–ª–∏—Ü—ã p50/p95/p99 –∏ –≤—ã–≤–æ–¥—ã.
- [ ] CI-—Å—Ç–∞—Ç—É—Å –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ç—á—ë—Ç—ã.
- [ ] –°–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

**–§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
- [ ] –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è.
- [ ] CRUD-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç.
- [ ] CI –∑–µ–ª—ë–Ω—ã–π.
- [ ] README –ø–æ–ª–æ–Ω –∏ –ø–æ–Ω—è—Ç–µ–Ω.

---

## üìÖ –¢–∞–π–º–∏–Ω–≥ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ)

| –≠—Ç–∞–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ä–µ–º—è |
|------|-----------|--------|
| 1 | –û–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | 1 –¥–µ–Ω—å |
| 2 | –ú–æ–¥–µ–ª–∏ –∏ Mongo | 1 –¥–µ–Ω—å |
| 3 | CRUD-API | 2 –¥–Ω—è |
| 4 | ELK | 1 –¥–µ–Ω—å |
| 5 | –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ë–î | 2 –¥–Ω—è |
| 6 | Sentry | 0.5 –¥–Ω—è |
| 7 | CI/CD | 1‚Äì2 –¥–Ω—è |
| 8 | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ä–µ–≤—å—é | 1 –¥–µ–Ω—å |
| **–ò—Ç–æ–≥–æ** | **~9 –¥–Ω–µ–π (—Å –∑–∞–ø–∞—Å–æ–º)** |

---

## ‚úÖ Definition of Done

- [ ] CRUD-API –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ.
- [ ] MongoDB –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏–Ω–¥–µ–∫—Å—ã –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç.
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ Mongo vs Postgres –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ.
- [ ] –õ–æ–≥–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ ELK, –¥–∞—à–±–æ—Ä–¥ –µ—Å—Ç—å.
- [ ] –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Sentry.
- [ ] CI –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ PR –∏ push.
- [ ] Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç.
- [ ] README –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–Ω—è—Ç–µ–Ω —Ä–µ–≤—å—é–µ—Ä—É.
```

---
